# App Settings
APP_ENV=development
FITAI_ENV=development  # preferred runtime mode switch: development|production (fallback to APP_ENV)
# Do not set legacy ENV=... variable; it can create misleading runtime logs.
APP_HOST=0.0.0.0
APP_PORT=8000
LOG_LEVEL=info
# Production defaults: APP_ENV=production, LOG_LEVEL=info

# CORS
# CSV allowlist. If empty:
# - development defaults to localhost origins
# - production denies cross-origin unless explicitly configured
CORS_ALLOW_ORIGINS=
# Production example: CORS_ALLOW_ORIGINS=https://app.example.com,https://www.app.example.com
# Optional regex. If empty:
# - development defaults to trycloudflare tunnel regex
# - production has no regex fallback
CORS_ALLOW_ORIGIN_REGEX=

# CORS (optional: use only for direct cross-origin requests)
# Dev example: CORS_ALLOW_ORIGINS=http://localhost:5174,http://localhost:8000
# Dev example: CORS_ALLOW_ORIGIN_REGEX=^https://[-a-z0-9]+\.trycloudflare\.com$
# Prod recommendation: explicit CORS_ALLOW_ORIGINS only, keep regex empty

# Telegram & Auth
BOT_TOKEN=        # Telegram bot token from @BotFather
TELEGRAM_BOT_TOKEN=  # Optional alias for BOT_TOKEN, used by retention jobs (send only to users with notifications_enabled=true)
JWT_SECRET=       # Random long secret for JWT signing (rotate -> existing tokens invalid)
AUTH_INITDATA_MAX_AGE_SEC=86400  # 24 hours
TELEGRAM_INITDATA_MAX_AGE_SECONDS=  # optional alias for AUTH_INITDATA_MAX_AGE_SEC
JWT_EXPIRES_SEC=604800           # 7 days

# AI (OpenRouter)
OPENROUTER_API_KEY=
OPENROUTER_BASE_URL=https://openrouter.ai/api/v1
OPENROUTER_MODEL=google/gemini-3.0-flash-preview
OPENROUTER_CONNECT_TIMEOUT_SEC=5
OPENROUTER_READ_TIMEOUT_SEC=40
OPENROUTER_MAX_RETRIES=1

# Database & Storage (Supabase)
SUPABASE_URL=
SUPABASE_SERVICE_ROLE_KEY=
SUPABASE_DATABASE_URL=   # postgresql://postgres:[password]@db.[project-id].supabase.co:5432/postgres
SUPABASE_STORAGE_BUCKET=meals
DB_STATEMENT_TIMEOUT_MS=5000
DB_SLOW_QUERY_MS=300

# Payments (YooKassa)
YOOKASSA_SHOP_ID=
YOOKASSA_SECRET_KEY=
YOOKASSA_WEBHOOK_USERNAME=
YOOKASSA_WEBHOOK_PASSWORD=
YOOKASSA_RETURN_URL_DEFAULT=
YOOKASSA_API_BASE_URL=https://api.yookassa.ru/v3
YOOKASSA_CONNECT_TIMEOUT_SEC=5
YOOKASSA_READ_TIMEOUT_SEC=20
YOOKASSA_MAX_RETRIES=1
PAYMENTS_WEBHOOK_DEV_BYPASS=0
PAYMENTS_WEBHOOK_IP_ALLOWLIST=  # Optional CSV: e.g. 203.0.113.10,198.51.100.0/24
# Premium upgrade policy (MVP): no auto-renew, access is extended only after successful webhook-confirmed payment.

# Business Logic
SUBSCRIPTION_PRICE_RUB=499
SUBSCRIPTION_DURATION_DAYS=30
MEALS_ANALYZE_MAX_IMAGE_BYTES=10485760
MEALS_ANALYZE_RATE_LIMIT_PER_MINUTE=10

# Strict production guidance:
# - FITAI_ENV=production
# - PAYMENTS_WEBHOOK_DEV_BYPASS=0
# - CORS_ALLOW_ORIGINS must be explicit allowlist

# Dev/Test switches
MEALS_ANALYZE_FORCE_FAIL_AFTER_RESERVE=0  # Dev/test only: force failure right after quota reserve
